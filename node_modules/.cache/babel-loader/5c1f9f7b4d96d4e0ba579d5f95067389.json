{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\TG\\\\Desktop\\\\mandatory-advanced-js5\\\\src\\\\Components\\\\Main.js\";\nimport React, { Component } from 'react';\nimport { Dropbox } from \"dropbox\";\nimport LogOut from './LogOut';\nimport LeftNav from \"./LeftNav\";\nimport Folders from \"./Folders\";\nimport RightNav from \"./RightNav\";\nimport Header from './Header';\nimport { Redirect } from 'react-router-dom';\nimport '../Css/icons.css';\nimport '../Css/mainFiles.css';\nimport '../Css/nav.css';\nimport '../Css/UlItems.css';\n\nclass Main extends Component {\n  constructor(props) {\n    super(props);\n\n    this.setFolderState = newFolder => {\n      this.setState({\n        folder: newFolder\n      });\n    };\n\n    this.setFileState = newFile => {\n      this.setState({\n        file: newFile\n      });\n    };\n\n    this.copy = (original_path, your_path) => {\n      let real_path = original_path.split('/');\n      real_path = `/${real_path[real_path.length - 1]}`;\n      console.log(`${your_path}${real_path}`);\n      this.dbx.filesCopy({\n        from_path: original_path,\n        to_path: `${your_path}${real_path}`,\n        autorename: true\n      });\n    };\n\n    this.search_FOLDERS_FILES = e => {\n      let resFolder;\n      console.log(\"TESTA\", e.target.value);\n      this.setState({\n        searchQuery: e.target.value\n      });\n\n      if (e.target.value.length === 0) {\n        return;\n      }\n\n      this.dbx.filesSearch({\n        path: '',\n        query: e.target.value\n      }).then(res => {\n        console.log(res);\n        resFolder = res;\n        let entries = res.matches.map(x => x.metadata);\n        this.setState({\n          folders: entries\n        });\n        entries = entries.filter(x => x[\".tag\"] === \"file\").map(x => ({\n          path: x.path_display\n        }));\n        return this.dbx.filesGetThumbnailBatch({\n          entries: entries\n        });\n      }).then(res => {\n        const files = resFolder.matches.filter(x => x[\".tag\"] !== \"folder\").map(x => {\n          const th = res.entries.find(y => y.metadata && y.metadata.id === x.metadata.id);\n          return {\n            metadata: x.metadata,\n            \".tag\": \"success\",\n            thumbnail: th ? th.thumbnail : null\n          };\n        });\n        console.log(files);\n        this.setState({\n          files: files\n        });\n      });\n    };\n\n    this.state = {\n      folders: [],\n      files: [],\n      changes: false,\n      starArray: [],\n      searchQuery: \"\"\n    };\n    this.renameRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.setState({\n      starArray: JSON.parse(window.localStorage.getItem(\"favorites\") || \"[]\")\n    });\n    let log = JSON.parse(window.localStorage.getItem(\"favorites\"));\n    this.dbx = new Dropbox({\n      accessToken: localStorage.getItem(\"token\")\n    });\n    let path = \"\";\n\n    if (this.props.match.params.path) {\n      path = `/${this.props.match.params.path}`;\n    }\n\n    this.dbx.filesListFolder({\n      path: path\n    }).then(resFolder => {\n      console.log(resFolder);\n      this.dbx.filesListFolderLongpoll({\n        cursor: resFolder.cursor\n      }).then(response => {\n        console.log('lol');\n        this.setState({\n          changes: response.changes\n        });\n      });\n      const entries = resFolder.entries.filter(x => x[\".tag\"] === \"file\").map(x => ({\n        path: x.path_display\n      }));\n      return this.dbx.filesGetThumbnailBatch({\n        entries: entries\n      }).then(res => {\n        const files = resFolder.entries.filter(x => x[\".tag\"] !== \"folder\").map(x => {\n          const th = res.entries.find(y => y.metadata && y.metadata.id === x.id);\n          return {\n            metadata: x,\n            \".tag\": \"success\",\n            thumbnail: th ? th.thumbnail : null\n          };\n        });\n        this.setState({\n          files: files,\n          folders: resFolder.entries\n        });\n      });\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.changes || this.props.match.params.path !== prevProps.match.params.path || this.state.searchQuery === \"\" && prevState.searchQuery !== this.state.searchQuery) {\n      console.log('lol');\n      let path = \"\";\n\n      if (this.props.match.params.path) {\n        path = `/${this.props.match.params.path}`;\n      }\n\n      this.dbx.filesListFolder({\n        path: path\n      }).then(resFolder => {\n        this.dbx.filesListFolderLongpoll({\n          cursor: resFolder.cursor\n        }).then(response => this.setState({\n          changes: response.changes\n        }));\n        const entries = resFolder.entries.filter(x => x[\".tag\"] === \"file\").map(x => ({\n          path: x.path_display\n        }));\n        return this.dbx.filesGetThumbnailBatch({\n          entries: entries\n        }).then(res => {\n          const files = resFolder.entries.filter(x => x[\".tag\"] !== \"folder\").map(x => {\n            const th = res.entries.find(y => y.metadata && y.metadata.id === x.id);\n            return {\n              metadata: x,\n              \".tag\": \"success\",\n              thumbnail: th ? th.thumbnail : null\n            };\n          });\n          this.setState({\n            files: files,\n            folders: resFolder.entries,\n            changes: false\n          });\n        });\n      });\n    }\n  }\n\n  render() {\n    const {\n      folders,\n      files\n    } = this.state;\n    return React.createElement(\"div\", {\n      className: \"App\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    }, React.createElement(LeftNav, {\n      dbx: this.dbx,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"bigBox\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, React.createElement(Header, {\n      search_FOLDERS_FILES: this.search_FOLDERS_FILES,\n      path: this.props.match.params.path,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }), React.createElement(\"main\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }, React.createElement(Folders, {\n      dbx: this.dbx,\n      files: files,\n      renameFiles: this.renameFiles,\n      updateFileName: this.updateFileName,\n      copy: this.copy,\n      renameFolders: this.renameFolders,\n      updateFolderName: this.updateFolderName,\n      folders: folders,\n      onDelete: this.onDelete,\n      setFileState: this.setFileState,\n      setFolderState: this.setFolderState,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }), React.createElement(RightNav, {\n      path: this.props.match.params.path,\n      files: files,\n      folders: folders,\n      dbx: this.dbx,\n      setFileState: this.setFileState,\n      setFolderState: this.setFolderState,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nexport default Main;","map":{"version":3,"sources":["C:/Users/TG/Desktop/mandatory-advanced-js5/src/Components/Main.js"],"names":["React","Component","Dropbox","LogOut","LeftNav","Folders","RightNav","Header","Redirect","Main","constructor","props","setFolderState","newFolder","setState","folder","setFileState","newFile","file","copy","original_path","your_path","real_path","split","length","console","log","dbx","filesCopy","from_path","to_path","autorename","search_FOLDERS_FILES","e","resFolder","target","value","searchQuery","filesSearch","path","query","then","res","entries","matches","map","x","metadata","folders","filter","path_display","filesGetThumbnailBatch","files","th","find","y","id","thumbnail","state","changes","starArray","renameRef","createRef","componentDidMount","JSON","parse","window","localStorage","getItem","accessToken","match","params","filesListFolder","filesListFolderLongpoll","cursor","response","componentDidUpdate","prevProps","prevState","render","renameFiles","updateFileName","renameFolders","updateFolderName","onDelete"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Dropbox } from \"dropbox\";\nimport LogOut from './LogOut'\nimport LeftNav from \"./LeftNav\"\nimport Folders from \"./Folders\"\nimport RightNav from \"./RightNav\"\nimport Header from './Header'\nimport {Redirect} from 'react-router-dom'\n\nimport '../Css/icons.css'\nimport '../Css/mainFiles.css'\nimport '../Css/nav.css'\nimport '../Css/UlItems.css'\n\nclass Main extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n          folders: [],\n          files: [],\n\n          changes: false,\n\n          starArray: [],\n\n          searchQuery: \"\",\n\n        }\n        this.renameRef = React.createRef();\n    }\n    setFolderState = (newFolder) =>{\n      this.setState({folder: newFolder})\n    }\n    setFileState = (newFile) =>{\n      this.setState({file: newFile})\n    }\n\n\n\n    copy = (original_path, your_path) =>{\n      let real_path = original_path.split('/')\n      real_path = `/${real_path[real_path.length-1]}`\n      console.log(`${your_path}${real_path}`,)\n      this.dbx.filesCopy({\n        from_path: original_path,\n        to_path: `${your_path}${real_path}`,\n        autorename: true,\n      })\n    }\n\n    componentDidMount() {\n      this.setState({\n        starArray: JSON.parse(window.localStorage.getItem(\"favorites\") || \"[]\")\n      });\n        let log = JSON.parse(window.localStorage.getItem(\"favorites\"));\n\n      this.dbx = new Dropbox({ accessToken: localStorage.getItem(\"token\") });\n      let path = \"\"\n\n      if(this.props.match.params.path){\n        path = `/${this.props.match.params.path}`\n      }\n      this.dbx.filesListFolder({ path: path })\n      .then((resFolder) => {\n        console.log(resFolder)\n        this.dbx.filesListFolderLongpoll({cursor: resFolder.cursor})\n        .then(response => {\n          console.log('lol')\n          this.setState({changes: response.changes})\n\n        })\n\n        const entries = resFolder.entries\n          .filter(x => x[\".tag\"] === \"file\")\n          .map((x) => ({ path: x.path_display }));\n        return this.dbx.filesGetThumbnailBatch({\n          entries: entries,\n        })\n        .then((res) => {\n          const files = resFolder.entries\n            .filter(x => x[\".tag\"] !== \"folder\")\n            .map(x => {\n              const th = res.entries.find(y => y.metadata && y.metadata.id === x.id);\n\n              return {\n                metadata: x,\n                \".tag\": \"success\",\n                thumbnail: th ? th.thumbnail : null,\n              }\n            });\n\n          this.setState({ files: files, folders: resFolder.entries});\n        })\n      })\n\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n\n      if (this.state.changes || this.props.match.params.path !== prevProps.match.params.path || (this.state.searchQuery === \"\" && (prevState.searchQuery !== this.state.searchQuery))) {\n        console.log('lol')\n\n        let path = \"\"\n        if(this.props.match.params.path){\n          path = `/${this.props.match.params.path}`\n        }\n        this.dbx.filesListFolder({ path: path })\n        .then((resFolder) => {\n\n          this.dbx.filesListFolderLongpoll({cursor: resFolder.cursor})\n          .then(response => this.setState({changes: response.changes}))\n\n          const entries = resFolder.entries\n            .filter(x => x[\".tag\"] === \"file\")\n            .map((x) => ({ path: x.path_display }));\n          return this.dbx.filesGetThumbnailBatch({\n            entries: entries,\n          })\n          .then((res) => {\n            const files = resFolder.entries\n            .filter(x => x[\".tag\"] !== \"folder\")\n            .map(x => {\n              const th = res.entries.find(y => y.metadata && y.metadata.id === x.id);\n\n              return {\n                metadata: x,\n                \".tag\": \"success\",\n                thumbnail: th ? th.thumbnail : null,\n              }\n            });\n            this.setState({ files: files, folders: resFolder.entries, changes:false });\n          })\n        })\n  }\n\n  }\n\n  search_FOLDERS_FILES = (e) => {\n\n    let resFolder;\n\n    console.log(\"TESTA\", e.target.value);\n\n    this.setState({ searchQuery: e.target.value });\n\n    if (e.target.value.length === 0) {\n      return;\n    }\n\n    this.dbx.filesSearch({ path: '' , query: e.target.value})\n    .then(res => {\n\n\n\n      console.log(res)\n\n      resFolder = res;\n      let entries = res.matches.map(x => x.metadata);\n\n      this.setState({ folders: entries });\n      entries = entries\n        .filter(x => x[\".tag\"] === \"file\")\n        .map((x) => ({ path: x.path_display }));\n      return this.dbx.filesGetThumbnailBatch({\n        entries: entries,\n      });\n      })\n      .then((res) => {\n\n        const files = resFolder.matches\n        .filter(x => x[\".tag\"] !== \"folder\")\n        .map(x => {\n          const th = res.entries.find(y => y.metadata && y.metadata.id === x.metadata.id);\n\n          return {\n            metadata: x.metadata,\n            \".tag\": \"success\",\n            thumbnail: th ? th.thumbnail : null,\n          }\n        });\n\n        console.log(files);\n        this.setState({ files: files });\n      });\n\n\n  }\n\n\n\n    render() {\n\n\n      const { folders, files } = this.state;\n\n        return (\n          <div className=\"App\" >\n\n          <LeftNav dbx={this.dbx}/>\n        <div className={\"bigBox\"}>\n          <Header search_FOLDERS_FILES={this.search_FOLDERS_FILES} path={this.props.match.params.path}/>\n          <main>\n            <Folders dbx={this.dbx} files={files} renameFiles={this.renameFiles} updateFileName={this.updateFileName} copy={this.copy}\n            renameFolders={this.renameFolders} updateFolderName={this.updateFolderName} folders={folders} onDelete={this.onDelete}  setFileState={this.setFileState} setFolderState={this.setFolderState}/>\n            <RightNav path={this.props.match.params.path} files={files} folders={folders} dbx={this.dbx} setFileState={this.setFileState} setFolderState={this.setFolderState} />\n          </main>\n        </div>\n    </div>\n      )\n    }\n  }\n\nexport default Main\n"]},"metadata":{},"sourceType":"module"}